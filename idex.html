<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü–æ–∏—Å–∫ PlayerId (PHP-–≤–µ—Ä—Å–∏—è)</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 500px; margin: auto; }
    input, button { padding: 10px; width: 100%; margin: 5px 0; box-sizing: border-box; }
    #result { margin-top: 20px; padding: 15px; background: #f4f4f4; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h2>üîç –ü–æ–∏—Å–∫ PlayerId —á–µ—Ä–µ–∑ PHP</h2>
  <form id="searchForm">
    <input type="text" name="nickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º" required autofocus>
    <button type="submit">–ù–∞–π—Ç–∏ ID</button>
  </form>
  <div id="result"></div>

  <script>
    document.getElementById('searchForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const nickname = formData.get('nickname');
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '‚è≥ –ü–æ–∏—Å–∫...';

      try {
        const res = await fetch('search.php', {
          method: 'POST',
          body: formData
        });
        const text = await res.text();
        
        // –ü–æ–ø—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è ‚Äî –ø–æ–∫–∞–∂–µ–º –∫–∞–∫ –µ—Å—Ç—å
        try {
          const data = JSON.parse(text);
          if (data.error) {
            resultDiv.innerHTML = `<span class="error">‚ùå ${data.error}</span>`;
          } else if (data.users && data.users.length > 0) {
            let html = `<h3>‚úÖ –ù–∞–π–¥–µ–Ω–æ:</h3><ul>`;
            data.users.forEach(u => {
              html += `<li><strong>${u.name}</strong> ‚Äî ID: <code>${u.id}</code> ${u.hasVerifiedBadge ? '‚úÖ' : ''}</li>`;
            });
            html += '</ul>';
            resultDiv.innerHTML = html;
          } else {
            resultDiv.innerHTML = 'üì≠ –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.';
          }
        } catch {
          // –ï—Å–ª–∏ PHP –≤—ã–¥–∞–ª –æ—à–∏–±–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, Fatal error), –ø–æ–∫–∞–∂–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç
          resultDiv.innerHTML = `<pre style="color:red; white-space:pre-wrap">${text}</pre>`;
        }
      } catch (err) {
        resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞: ${err.message}</span>`;
      }
    });
  </script>
</body>
</html>
